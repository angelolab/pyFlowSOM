dist: xenial
language: python
python:
  - 3.8

git:
  depth: false

jobs:
  include:
    # perform a linux build
    - services: docker
    # perform a linux ARMv8 build
    - services: docker
      arch: arm64
    # perform a linux PPC64LE build
    - services: docker
      arch: ppc64le
    # perform a linux S390X build
    - services: docker
      arch: s390x
    # and a windows build
    - os: windows
      language: shell
      before_install:
        - choco upgrade python -y --version 3.8.6
        - export PATH="/c/Python38:/c/Python38/Scripts:$PATH"
        # make sure it's on PATH as 'python3'
        - ln -s /c/Python38/python.exe /c/Python38/python3.exe

cache: pip

install:
  - travis_retry pip install --upgrade pip setuptools wheel
  - travis_retry pip install -r requirements.txt -r requirements-test.txt
  - travis_retry pip install cibuildwheel

script:
  - pip install -e .
  - python -m pytest --randomly-seed=42 --randomly-dont-reorganize --cov=pyFlowSOM --pycodestyle pyFlowSOM
  - git clean -fdx
  - python -m cibuildwheel --output-dir wheelhouse
  - ls -al wheelhouse

after_failure:
  - cat out.log

after_success:
  - coveralls
